<!-- 
不带emoji国旗
 -->
<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>打卡成就地图</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='output.min.js'></script>
    <link href='user_main.css' rel='stylesheet' />
</head>

<body>
    <div id='map'></div>
    <div class='blacktop'></div>
    <div class='blackbottom'></div>
    <div class='map-overlay' id='features'>
        <h2>打卡成就地图</h2>
        <p>旅拍<span class='yellow'>点亮</span>我的世界</p>
    </div>
    <div class='map-overlay' id='features2'></div>
    <button id='snapshotbtn' class='snapshotbtn' type="button"></button>
    <script>
        function init(g){mapboxgl.accessToken="pk.eyJ1IjoiaWZvb2J0b29rIiwiYSI6ImNqdnczZ3plODF5dDE0YW5uNGhpNWcyanAifQ.qgmnnkw85aN0xuI2HVcgHw";var b=new mapboxgl.Map({container:"map",style:"mapbox://styles/ifoobtook/ck03xel6y1wyg1co8cign1jy3?optimize=true",minZoom:0,maxZoom:6,center:[121,31],attributionControl:false,logoPosition:"bottom-left"});b.dragRotate.disable();b.touchZoomRotate.disableRotation();b.addControl(new mapboxgl.AttributionControl(),"bottom-right");var c=[];var k=[];var a=[];var d=[];var e=[];var i=[];var j=[];var h="用户";var f=0;g.features.forEach(function(l){if(l.properties["code"]=="0"){h=l.properties["country"]}else{c.push(l.properties["country"]);k.push(l.properties["city"]);e.push(l.properties["flag"]);if(l.properties["count"]>100){i.push(l.geometry.coordinates)}if(l.properties["count"]>10&&l.properties["count"]<101){j.push(l.geometry.coordinates)}if(l.properties["country"]=="中国"){a.push(l.properties["city"])}else{d.push(l.properties["city"])}}});user_countrys2=Array.from(new Set(c));user_cities2=Array.from(new Set(k));flag_list2=Array.from(new Set(e));china_cities2=Array.from(new Set(a));foreign_cities2=Array.from(new Set(d));flag_list_str="";china_cities_str="国内:";foreign_cities_str="海外:";user_countrys2.forEach(function(l){flag_list_str=flag_list_str+" "+l});china_cities2.forEach(function(l){if(china_cities_str.length<20){china_cities_str=china_cities_str+" "+l}});china_cities_str=china_cities_str+"等";foreign_cities2.forEach(function(l){if(foreign_cities_str.length<20){foreign_cities_str=foreign_cities_str+" "+l}});foreign_cities_str=foreign_cities_str+"等";count_country=user_countrys2.length;count_city=user_cities2.length;console.log(user_countrys2);if(count_city==1){f=20}else{if(count_city>1&&count_city<5){f=50}else{if(count_city>5&&count_city<10){f=80}else{if(count_city>10&&count_city<50){f=90}else{if(count_city>50&&count_city<100){f=95}else{f=99}}}}}b.on("load",function(){var r=b.getStyle().layers;var l;for(var p=0;p<r.length;p++){if(r[p].type==="symbol"){l=r[p].id;break}}b.addSource("world",{"type":"vector","url":"mapbox://ifoobtook.15dsdp9u"});b.addSource("china",{"type":"vector","url":"mapbox://ifoobtook.ahpjg5fn"});b.addSource("city_cood",{"type":"vector","url":"mapbox://ifoobtook.4vgdytyx"});var o="rgba(74,101,240,0.5)";var n=["match",["get","name"]];user_countrys2.forEach(function(u){var t=o;n.push(u,t)});n.push("rgba(0,0,0,0)");var q=["match",["get","city"]];user_cities2.forEach(function(u){var t=o;q.push(u,t)});q.push("rgba(0,0,0,0)");b.addLayer({"id":"user_poi","type":"circle","source":{"type":"geojson","data":g},"filter": ["!=", ["get", "code"], "0"],"paint":{"circle-radius":["interpolate",["exponential",0.5],["zoom"],0,0.1,5,3],"circle-opacity":0.9,"circle-color":["case",["all",[">",["to-number",["get","count"]],1],["<",["to-number",["get","count"]],30]],"#FFDF6F","#FFDF6F"]}});b.addLayer({"id":"user-world","type":"fill","source":"world","source-layer":"world_cngeo","paint":{"fill-color":n,"fill-opacity":["interpolate",["exponential",0.5],["zoom"],2,1,6,0.5],}},l);b.addLayer({"id":"user-china","type":"fill","source":"china","minzoom":3,"source-layer":"china_city-8j2v49","paint":{"fill-color":q}},l);function m(x,y,t,w,v){var u=document.createElement("div");u.className=t;new mapboxgl.Marker(u,{offset:{x:w,y:v}}).setLngLat(y).addTo(x)}i.forEach(function(t){m(b,t,"marker1",0,-12)});j.forEach(function(t){m(b,t,"marker2",0,-8)});function s(t,u){var B=document.getElementById("features2");var z=B.appendChild(document.createElement("div"));z.className="feature_line";z.innerHTML='<span class="data_user">'+h+"</span>";var C=B.appendChild(document.createElement("div"));C.className="feature_line";C.innerHTML='<span class="data2">超越了</span>'+'<span class="data">'+f+"</span>"+'<span class="data2">%的地球人</span>';var A=B.appendChild(document.createElement("div"));A.className="feature_line";A.innerHTML='<span class="data2">点亮</span>'+'<span class="data">'+t+"</span>"+'<span class="data2">个国家</span>';var w=B.appendChild(document.createElement("div"));w.className="feature_line";w.innerHTML='<span class="data_flag">'+flag_list_str+"</span>";var y=B.appendChild(document.createElement("div"));y.className="feature_line";y.innerHTML='<span class="data2">点亮</span>'+'<span class="data">'+u+"</span>"+'<span class="data2">个城市</span>';var v=B.appendChild(document.createElement("div"));v.className="feature_line";v.innerHTML='<span class="data_city">'+china_cities_str+"</span>";var x=B.appendChild(document.createElement("div"));x.className="feature_line";x.innerHTML='<span class="data_city">'+foreign_cities_str+"</span>"}s(count_country,count_city)})};
    </script>
    <script>
        function page(json){
            $(document).ready(function () {
                init(eval('(' + json + ')'));
            });
            $(function() { 
                $(".snapshotbtn").click(function() { 
                    document.getElementById("features").style.visibility = "hidden";
                    document.getElementById("snapshotbtn").style.visibility = "hidden";
                    html2canvas(document.body).then(function(canvas) {
                        var dataUrl = canvas.toDataURL();//图片base64地址
                        // console.log(dataUrl);
                        return dataUrl
                    }).then(function(dataUrl) {
                        document.getElementById("features").style.visibility = "visible";
                        document.getElementById("snapshotbtn").style.visibility = "visible";
                        window.webkit.messageHandlers.HanderModel.postMessage(dataUrl);
                    });
                    
                })
            });
        };
        page('{"type":"FeatureCollection","features":[{"type":"feature","properties":{"city":"","country":"打卡达人","code":"0","count":"","lon":"0.0","flag":"","year":"","lat":"0.0","month":""},"geometry":{"type":"Point","coordinates":[0,0]}},{"type":"feature","properties":{"city":"巴厘岛","country":"印度尼西亚","code":"2948","count":"607","lon":"115.1317","flag":"🇮🇩","year":"2017","lat":"-8.3696","month":"7"},"geometry":{"type":"Point","coordinates":[115.1317,-8.3696000000000002]}},{"type":"feature","properties":{"city":"上海","country":"中国","code":"104","count":"168","lon":"121.6019","flag":"🇨🇳","year":"2019","lat":"31.1966","month":"9"},"geometry":{"type":"Point","coordinates":[121.6019,31.1966]}},{"type":"feature","properties":{"city":"黄山市","country":"中国","code":"138","count":"103","lon":"118.0764","flag":"🇨🇳","year":"2015","lat":"29.9061","month":"4"},"geometry":{"type":"Point","coordinates":[118.07640000000001,29.906099999999999]}},{"type":"feature","properties":{"city":"布拉格","country":"捷克","code":"4619","count":"66","lon":"14.5626","flag":"🇨🇿","year":"2015","lat":"50.1395","month":"7"},"geometry":{"type":"Point","coordinates":[14.5626,50.139499999999998]}},{"type":"feature","properties":{"city":"卡尔斯巴德","country":"美国","code":"5242","count":"57","lon":"-117.2829","flag":"🇺🇸","year":"2016","lat":"33.1248","month":"7"},"geometry":{"type":"Point","coordinates":[-117.2829,33.1248]}},{"type":"feature","properties":{"city":"塞班岛","country":"北马里亚纳群岛","code":"5390","count":"35","lon":"145.7539","flag":"🇲🇵","year":"2019","lat":"15.1892","month":"1"},"geometry":{"type":"Point","coordinates":[145.75389999999999,15.1892]}},{"type":"feature","properties":{"city":"香港","country":"中国","code":"429","count":"22","lon":"114.1876","flag":"🇨🇳","year":"2014","lat":"22.336","month":"2"},"geometry":{"type":"Point","coordinates":[114.1876,22.335999999999999]}},{"type":"feature","properties":{"city":"文图拉","country":"美国","code":"5124","count":"20","lon":"-119.097","flag":"🇺🇸","year":"2016","lat":"34.4765","month":"7"},"geometry":{"type":"Point","coordinates":[-119.09699999999999,34.476500000000001]}},{"type":"feature","properties":{"city":"深圳","country":"中国","code":"270","count":"13","lon":"114.1044","flag":"🇨🇳","year":"2013","lat":"22.5976","month":"8"},"geometry":{"type":"Point","coordinates":[114.1044,22.5976]}},{"type":"feature","properties":{"city":"福州","country":"中国","code":"146","count":"12","lon":"119.313","flag":"🇨🇳","year":"2014","lat":"25.9808","month":"9"},"geometry":{"type":"Point","coordinates":[119.313,25.980799999999999]}},{"type":"feature","properties":{"city":"蒙特雷","country":"美国","code":"5161","count":"11","lon":"-121.2368","flag":"🇺🇸","year":"2016","lat":"36.2141","month":"7"},"geometry":{"type":"Point","coordinates":[-121.2368,36.214100000000002]}},{"type":"feature","properties":{"city":"苏州","country":"中国","code":"109","count":"11","lon":"120.6521","flag":"🇨🇳","year":"2019","lat":"31.3808","month":"6"},"geometry":{"type":"Point","coordinates":[120.6521,31.380800000000001]}},{"type":"feature","properties":{"city":"海西","country":"中国","code":"353","count":"11","lon":"95.1176","flag":"🇨🇳","year":"2019","lat":"37.2835","month":"8"},"geometry":{"type":"Point","coordinates":[95.117599999999996,37.283499999999997]}},{"type":"feature","properties":{"city":"酒泉","country":"中国","code":"340","count":"10","lon":"96.2438","flag":"🇨🇳","year":"2017","lat":"40.4598","month":"8"},"geometry":{"type":"Point","coordinates":[96.243799999999993,40.459800000000001]}},{"type":"feature","properties":{"city":"三亚","country":"中国","code":"304","count":"9","lon":"109.4175","flag":"🇨🇳","year":"2015","lat":"18.3637","month":"12"},"geometry":{"type":"Point","coordinates":[109.4175,18.363700000000001]}},{"type":"feature","properties":{"city":"大阪","country":"日本","code":"466","count":"9","lon":"135.5021","flag":"🇯🇵","year":"2015","lat":"34.6688","month":"2"},"geometry":{"type":"Point","coordinates":[135.50210000000001,34.668799999999997]}},{"type":"feature","properties":{"city":"宣城","country":"中国","code":"145","count":"8","lon":"118.8566","flag":"🇨🇳","year":"2015","lat":"30.6911","month":"4"},"geometry":{"type":"Point","coordinates":[118.8566,30.691099999999999]}},{"type":"feature","properties":{"city":"东京","country":"日本","code":"454","count":"7","lon":"139.7475","flag":"🇯🇵","year":"2015","lat":"35.6899","month":"2"},"geometry":{"type":"Point","coordinates":[139.7475,35.689900000000002]}},{"type":"feature","properties":{"city":"京都","country":"日本","code":"455","count":"7","lon":"135.7298","flag":"🇯🇵","year":"2015","lat":"35.1058","month":"2"},"geometry":{"type":"Point","coordinates":[135.72980000000001,35.105800000000002]}},{"type":"feature","properties":{"city":"箱根町","country":"日本","code":"1469","count":"7","lon":"139.0327","flag":"🇯🇵","year":"2015","lat":"35.2307","month":"2"},"geometry":{"type":"Point","coordinates":[139.03270000000001,35.230699999999999]}},{"type":"feature","properties":{"city":"图尔恰","country":"罗马尼亚","code":"3668","count":"6","lon":"28.8585","flag":"🇷🇴","year":"2013","lat":"45.0482","month":"8"},"geometry":{"type":"Point","coordinates":[28.858499999999999,45.048200000000001]}},{"type":"feature","properties":{"city":"北京","country":"中国","code":"232","count":"5","lon":"116.4107","flag":"🇨🇳","year":"2016","lat":"40.1849","month":"7"},"geometry":{"type":"Point","coordinates":[116.41070000000001,40.184899999999999]}},{"type":"feature","properties":{"city":"南宁","country":"中国","code":"289","count":"3","lon":"108.4634","flag":"🇨🇳","year":"2013","lat":"23.0587","month":"10"},"geometry":{"type":"Point","coordinates":[108.46339999999999,23.058700000000002]}},{"type":"feature","properties":{"city":"康斯坦察","country":"罗马尼亚","code":"3762","count":"3","lon":"28.2478","flag":"🇷🇴","year":"2013","lat":"44.2449","month":"8"},"geometry":{"type":"Point","coordinates":[28.247800000000002,44.244900000000001]}},{"type":"feature","properties":{"city":"大理","country":"中国","code":"418","count":"3","lon":"100.0393","flag":"🇨🇳","year":"2014","lat":"25.7292","month":"1"},"geometry":{"type":"Point","coordinates":[100.0393,25.729199999999999]}},{"type":"feature","properties":{"city":"杭州","country":"中国","code":"118","count":"3","lon":"119.5001","flag":"🇨🇳","year":"2015","lat":"29.9081","month":"2"},"geometry":{"type":"Point","coordinates":[119.5001,29.908100000000001]}},{"type":"feature","properties":{"city":"耶路撒冷","country":"以色列","code":"3071","count":"3","lon":"35.0074","flag":"🇮🇱","year":"2016","lat":"31.7464","month":"5"},"geometry":{"type":"Point","coordinates":[35.007399999999997,31.746400000000001]}},{"type":"feature","properties":{"city":"南京","country":"中国","code":"105","count":"2","lon":"118.842","flag":"🇨🇳","year":"2007","lat":"31.9302","month":"4"},"geometry":{"type":"Point","coordinates":[118.842,31.930199999999999]}},{"type":"feature","properties":{"city":"玉林","country":"中国","code":"297","count":"2","lon":"110.1832","flag":"🇨🇳","year":"2013","lat":"22.4433","month":"5"},"geometry":{"type":"Point","coordinates":[110.1832,22.443300000000001]}},{"type":"feature","properties":{"city":"柏林","country":"德国","code":"4266","count":"2","lon":"13.4019","flag":"🇩🇪","year":"2015","lat":"52.5015","month":"7"},"geometry":{"type":"Point","coordinates":[13.401899999999999,52.5015]}},{"type":"feature","properties":{"city":"湖州","country":"中国","code":"122","count":"1","lon":"119.871","flag":"🇨🇳","year":"2006","lat":"30.7462","month":"4"},"geometry":{"type":"Point","coordinates":[119.871,30.746200000000002]}},{"type":"feature","properties":{"city":"青岛","country":"中国","code":"167","count":"1","lon":"120.2043","flag":"🇨🇳","year":"2013","lat":"36.3645","month":"7"},"geometry":{"type":"Point","coordinates":[120.2043,36.3645]}},{"type":"feature","properties":{"city":"南通","country":"中国","code":"110","count":"1","lon":"121.0983","flag":"🇨🇳","year":"2013","lat":"32.2028","month":"9"},"geometry":{"type":"Point","coordinates":[121.09829999999999,32.202800000000003]}},{"type":"feature","properties":{"city":"塞勒斯塔埃尔斯坦","country":"法国","code":"4069","count":"1","lon":"7.5057","flag":"🇫🇷","year":"2015","lat":"48.3318","month":"7"},"geometry":{"type":"Point","coordinates":[7.5057,48.331800000000001]}},{"type":"feature","properties":{"city":"海德堡","country":"德国","code":"4332","count":"1","lon":"8.6942","flag":"🇩🇪","year":"2015","lat":"49.4055","month":"7"},"geometry":{"type":"Point","coordinates":[8.6942000000000004,49.405500000000004]}},{"type":"feature","properties":{"city":"舟山","country":"中国","code":"126","count":"1","lon":"122.2925","flag":"🇨🇳","year":"2018","lat":"30.3474","month":"1"},"geometry":{"type":"Point","coordinates":[122.2925,30.3474]}},{"type":"feature","properties":{"city":"那覇市","country":"日本","code":"1653","count":"1","lon":"127.6822","flag":"🇯🇵","year":"2018","lat":"26.2093","month":"1"},"geometry":{"type":"Point","coordinates":[127.68219999999999,26.209299999999999]}},{"type":"feature","properties":{"city":"驻马店","country":"中国","code":"199","count":"1","lon":"114.1477","flag":"🇨🇳","year":"2019","lat":"32.9243","month":"5"},"geometry":{"type":"Point","coordinates":[114.1477,32.924300000000002]}},{"type":"feature","properties":{"city":"三明","country":"中国","code":"149","count":"1","lon":"117.3952","flag":"🇨🇳","year":"2019","lat":"26.2999","month":"6"},"geometry":{"type":"Point","coordinates":[117.3952,26.299900000000001]}},{"type":"feature","properties":{"city":"周口","country":"中国","code":"198","count":"1","lon":"114.8774","flag":"🇨🇳","year":"2019","lat":"33.725","month":"8"},"geometry":{"type":"Point","coordinates":[114.87739999999999,33.725000000000001]}},{"type":"feature","properties":{"city":"阜阳","country":"中国","code":"140","count":"1","lon":"115.7005","flag":"🇨🇳","year":"2019","lat":"32.9164","month":"8"},"geometry":{"type":"Point","coordinates":[115.70050000000001,32.916400000000003]}}]}')
    </script>
</body>

</html>